import{w as G}from"./with-props-CIDimU0D.js";import{t as K,s as Q,a as s,o as t}from"./chunk-DQRVZFIR-CDtcAPRC.js";import{a as i}from"./ConfirmDialog-CgZmBqnd.js";import{g as X,H as R}from"./Header-D-1lqB9W.js";import"./iconBase-BIXBbqyS.js";import"./index-VWaDGczM.js";const de=G(function(){const{state:B}=K(),{cartItems:n}=B||{},I=Q(),[g,P]=s.useState([]),[x,T]=s.useState([]),[p,D]=s.useState([]),[l,L]=s.useState(""),[c,b]=s.useState(""),[f,h]=s.useState(""),[_,z]=s.useState(!1),[J,Z]=s.useState(null),[ee,te]=s.useState([]),[U,V]=s.useState([]),[m,q]=s.useState("COD"),[N,j]=s.useState(null),[y,v]=s.useState(null),[C,A]=s.useState(null),[S,F]=s.useState(null),[u,$]=s.useState(null),[H,se]=s.useState(null);s.useEffect(()=>{const e=X();if(e){F(e);const r=localStorage.getItem("fullname"),o=localStorage.getItem("phoneNumber");j(r),v(o),console.log("Token id:",e),console.log("Fullname trong localStorage:",r),console.log("Phone number trong localStorage:",o)}},[]),s.useEffect(()=>{i.get("/payment/payment-methods").then(e=>V(e.data)).catch(e=>console.error("Lỗi lấy phương thức thanh toán:",e))},[]),s.useEffect(()=>{l&&fetch(`https://provinces.open-api.vn/api/p/${l}?depth=2`).then(e=>e.json()).then(e=>T(e.districts||[]))},[l]),s.useEffect(()=>{c&&fetch(`https://provinces.open-api.vn/api/d/${c}?depth=2`).then(e=>e.json()).then(e=>D(e.wards||[]))},[c]),s.useEffect(()=>{fetch("https://provinces.open-api.vn/api/p/").then(e=>e.json()).then(e=>P(e)).catch(e=>console.error("Lỗi lấy tỉnh/thành:",e))},[]);const M=async()=>{var E,w,k;if(!n||n.length===0){alert("Giỏ hàng trống");return}const e=((E=g.find(a=>a.code===+l))==null?void 0:E.name)||"",r=((w=x.find(a=>a.code===+c))==null?void 0:w.name)||"",o=((k=p.find(a=>a.code===+f))==null?void 0:k.name)||"",d={note:H,paymentMethod:m,addressDTO:{receiverName:N,phoneNumber:y,homeAddress:C,city:e,district:r,commune:o},items:n.map(a=>({productId:a.product.id,quantity:a.quantity,price:a.product.price}))};try{let a=localStorage.getItem("sessionId");if(console.log("sessionId:",a),m==="VNPAY"){const W=await i.post(S?"/payment/create-vnpay":`/payment/create-vnpay?sessionId=${a}`,d);$(W.data.paymentUrl)}else{if(S)console.log("orderData gửi lên:",d),await i.post("/order/add",d);else{if(!a){alert("Không tìm thấy sessionId!");return}await i.post(`/order/add?sessionId=${a}`,d)}alert("Đặt hàng thành công!"),I("/")}}catch(a){console.error("Lỗi đặt hàng:",a),alert("Đặt hàng thất bại. Vui lòng kiểm tra lại.")}},O=(n==null?void 0:n.reduce((e,r)=>e+r.product.price*r.quantity,0))||0;return t.jsxs("div",{className:"bg-white min-h-screen",children:[t.jsx(R,{}),t.jsx("section",{className:"py-16 px-8 bg-[#f1ebe7]",children:t.jsxs("div",{className:"container mx-auto",children:[t.jsxs("div",{className:"text-center mb-12",children:[t.jsx("h2",{className:"text-3xl text-[#8B5E3C] font-bold uppercase",children:"Đặt hàng"}),t.jsx("div",{className:"w-20 h-1 bg-[#8B5E3C] mx-auto mt-4"}),t.jsx("p",{className:"italic text-gray-500 mt-2",children:"Hoàn tất thông tin đặt hàng của bạn"})]}),t.jsxs("div",{className:"max-w-7xl mx-auto grid grid-cols-1 md:grid-cols-2 gap-8",children:[t.jsxs("div",{className:"bg-white p-8 rounded-lg shadow-md border-l-4 border-[#8B5E3C]",children:[t.jsx("h2",{className:"text-xl font-bold mb-6 text-[#8B5E3C]",children:"Thông tin đặt hàng"}),t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"block mb-2 font-medium text-gray-700",children:"Tên khách hàng:"}),t.jsx("input",{type:"text",className:"border w-full mb-4 p-3 rounded bg-gray-50 border-[#d1c7bb] focus:border-[#8B5E3C] focus:ring-1 focus:ring-[#8B5E3C]",value:N??"",onChange:e=>j(e.target.value),placeholder:"Nhập tên khách hàng"})]}),t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"block mb-2 font-medium text-gray-700",children:"Số điện thoại:"}),t.jsx("input",{type:"text",className:"border w-full mb-4 p-3 rounded bg-gray-50 border-[#d1c7bb] focus:border-[#8B5E3C] focus:ring-1 focus:ring-[#8B5E3C]",value:y??"",onChange:e=>v(e.target.value),placeholder:"Nhập sđt khách hàng"})]}),t.jsxs("div",{className:"mx-auto grid grid-cols-1 md:grid-cols-3 gap-4",children:[t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"block mb-2 font-medium text-gray-700",children:"Tỉnh / Thành phố:"}),t.jsxs("select",{className:"border w-full p-3 rounded bg-gray-50 border-[#d1c7bb]",value:l,onChange:e=>{L(e.target.value),b(""),h("")},children:[t.jsx("option",{value:"",children:"-- Chọn tỉnh / thành phố --"}),g.map(e=>t.jsx("option",{value:e.code,children:e.name},e.code))]})]}),t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"block mb-2 font-medium text-gray-700",children:"Quận / Huyện:"}),t.jsxs("select",{className:"border w-full p-3 rounded bg-gray-50 border-[#d1c7bb]",value:c,onChange:e=>{b(e.target.value),h("")},disabled:!l,children:[t.jsx("option",{value:"",children:"-- Chọn quận / huyện --"}),x.map(e=>t.jsx("option",{value:e.code,children:e.name},e.code))]})]}),t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"block mb-2 font-medium text-gray-700",children:"Phường / Xã:"}),t.jsxs("select",{className:"border w-full p-3 rounded bg-gray-50 border-[#d1c7bb]",value:f,onChange:e=>h(e.target.value),disabled:!c,children:[t.jsx("option",{value:"",children:"-- Chọn phường / xã --"}),p.map(e=>t.jsx("option",{value:e.code,children:e.name},e.code))]})]})]}),t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"block mb-2 font-medium text-gray-700",children:"Địa chỉ nhà:"}),t.jsx("input",{type:"text",className:"border w-full mb-4 p-3 rounded bg-gray-50 border-[#d1c7bb] focus:border-[#8B5E3C] focus:ring-1 focus:ring-[#8B5E3C]",placeholder:"Nhập địa chỉ cụ thể",value:C??"",onChange:e=>A(e.target.value)})]}),t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"block mb-2 font-medium text-gray-700",children:"Ghi chú:"}),t.jsx("input",{type:"text",className:"border w-full mb-4 p-3 rounded bg-gray-50 border-[#d1c7bb] focus:border-[#8B5E3C] focus:ring-1 focus:ring-[#8B5E3C]",placeholder:"Nhập ghi chú (nếu có)"})]}),t.jsxs("div",{className:"mb-6",children:[t.jsx("label",{className:"block mb-3 font-medium text-gray-700",children:"Phương thức thanh toán:"}),t.jsx("div",{className:"space-y-2",children:U.map(e=>t.jsxs("div",{className:"flex items-center",children:[t.jsx("input",{type:"radio",id:`payment-${e}`,name:"paymentMethod",value:e,checked:m===e,onChange:()=>q(e),className:"h-4 w-4 text-[#8B5E3C] border-gray-300"}),t.jsx("label",{htmlFor:`payment-${e}`,className:"ml-2 text-sm text-gray-700",children:e})]},e))})]}),u&&t.jsxs("div",{className:"mt-6 bg-green-100 text-green-800 p-4 rounded",children:[t.jsx("p",{className:"font-medium mb-2",children:"Link thanh toán VNPay:"}),t.jsx("a",{href:u,target:"_blank",rel:"noopener noreferrer",className:"underline text-blue-600",children:u})]})]}),t.jsxs("div",{className:"bg-white p-8 rounded-lg shadow-md border-l-4 border-[#8B5E3C]",children:[t.jsx("h2",{className:"text-xl font-bold mb-6 text-[#8B5E3C]",children:"Sản phẩm đặt"}),n&&n.length>0?t.jsxs("div",{className:"space-y-4",children:[n.map(e=>t.jsxs("div",{className:"flex items-center justify-between py-3 border-b border-[#e0d6cc]",children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx("img",{src:e.product.imageUrl||"/default.png",alt:e.product.name,className:"w-16 h-16 rounded-full object-cover border-2 border-[#8B5E3C]"}),t.jsxs("div",{children:[t.jsx("p",{className:"font-semibold text-gray-800",children:e.product.name}),t.jsxs("p",{className:"text-sm text-gray-600",children:[e.quantity," x ",e.product.price.toLocaleString("vi-VN"),"đ"]})]})]}),t.jsxs("p",{className:"font-semibold text-[#8B5E3C]",children:[(e.quantity*e.product.price).toLocaleString("vi-VN"),"đ"]})]},e.id)),t.jsx("div",{className:"mt-6 pt-4 border-t border-[#e0d6cc]",children:t.jsxs("p",{className:"text-right text-xl font-bold text-gray-800",children:["Tổng: ",t.jsxs("span",{className:"text-[#8B5E3C]",children:[O.toLocaleString("vi-VN"),"đ"]})]})}),t.jsxs("div",{className:"mx-auto grid grid-cols-1 md:grid-cols-2 gap-4 mt-6 items-center",children:[t.jsx("span",{className:"text-sm text-gray-600 text-center md:text-left",children:t.jsx("a",{href:"/cart",className:"text-[#8B5E3C] hover:underline font-medium",children:"Quay về giỏ hàng"})}),t.jsx("button",{className:"bg-[#8B5E3C] text-white px-6 py-3 rounded-lg hover:bg-[#6d4a30] transition-colors w-full font-medium text-lg",onClick:M,children:"Xác nhận đặt hàng"})]})]}):t.jsx("p",{className:"text-gray-500 text-center py-8",children:"Không có sản phẩm nào trong giỏ hàng"})]})]})]})})]})});export{de as default};
