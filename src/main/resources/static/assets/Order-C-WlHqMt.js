import{w as V}from"./with-props-CIDimU0D.js";import{a,o as e}from"./chunk-DQRVZFIR-CDtcAPRC.js";import{L as g,a as F,b as U,c as q,d as B}from"./dialog-Yo9MHd0L.js";import{a as u,C as J}from"./ConfirmDialog-CgZmBqnd.js";import{S as K}from"./SideBar-CPVLx_RP.js";import"./iconBase-BIXBbqyS.js";import"./index-BRZMWsSF.js";const Q=[{value:"PENDING",label:"Chờ xác nhận"},{value:"CONFIRMED",label:"Đã xác nhận"},{value:"IN_PREPARATION",label:"Đang pha chế"},{value:"SERVED",label:"Đã phục vụ"},{value:"COMPLETED",label:"Hoàn tất"},{value:"CANCELED",label:"Đã hủy"}];function W({open:x,onClose:c,onAddOrUpdate:h,initialOrder:t}){const[r,o]=a.useState(""),[b,i]=a.useState(null);a.useEffect(()=>{o(t&&t.status||"")},[t,x]);const N=async()=>{var m,y;if(!r.trim()){alert("Vui lòng chọn trạng thái đơn hàng.");return}if(console.log("Loi "+t),!(t!=null&&t.id)){alert("Đơn hàng không hợp lệ.");return}const d={status:r};(m=t.user)!=null&&m.id,t.sessionId;try{await u.put(`/order/update/${t.id}`,d),i("Cập nhật đơn hàng thành công!"),setTimeout(()=>{h(),c(),i(null)},1e3)}catch(p){console.error("Lỗi khi cập nhật đơn hàng:",p),alert(((y=p.response)==null?void 0:y.data)||"Lỗi không xác định")}};return e.jsxs(g,{open:x,onClose:c,className:"fixed z-50 inset-0 flex items-center justify-center",children:[e.jsx("div",{className:"fixed inset-0 bg-black opacity-30","aria-hidden":"true"}),e.jsxs("div",{className:"bg-white rounded-xl p-6 z-50 shadow-xl w-[400px] max-h-[90vh] overflow-y-auto",children:[b&&e.jsx("div",{className:"bg-green-100 text-green-700 text-sm p-2 rounded mb-4 text-center",children:b}),e.jsx(g.Title,{className:"text-lg font-semibold mb-4",children:"Cập nhật Đơn Hàng"}),e.jsxs("select",{className:"w-full border px-3 py-2 mb-3 rounded",value:r,onChange:d=>o(d.target.value),children:[e.jsx("option",{value:"",children:"-- Chọn trạng thái --"}),Q.map(d=>e.jsx("option",{value:d.value,children:d.label},d.value))]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx("button",{onClick:c,className:"bg-gray-300 px-4 py-2 rounded hover:bg-gray-400",children:"Hủy"}),e.jsx("button",{onClick:N,className:"bg-blue-500 px-4 py-2 text-white rounded hover:bg-blue-600",children:"Cập nhật"})]})]})]})}function X({open:x,onClose:c,items:h}){return e.jsx(g,{open:x,onClose:c,className:"fixed z-50 inset-0 overflow-y-auto",children:e.jsx("div",{className:"flex items-center justify-center min-h-screen p-4 bg-opacity-100",children:e.jsxs(g.Panel,{className:"bg-white rounded-lg max-w-xl w-full p-6 shadow-xl",children:[e.jsx(g.Title,{className:"text-lg font-bold mb-4",children:"Chi tiết đơn hàng"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left border",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-2",children:"#"}),e.jsx("th",{className:"p-2",children:"Sản phẩm"}),e.jsx("th",{className:"p-2",children:"Image"}),e.jsx("th",{className:"p-2",children:"Số lượng"}),e.jsx("th",{className:"p-2",children:"Giá"}),e.jsx("th",{className:"p-2",children:"Tổng tiền"})]})}),e.jsx("tbody",{children:h.map((t,r)=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"p-2",children:r+1}),e.jsx("td",{className:"p-2",children:t.productName}),e.jsx("td",{className:"p-2",children:e.jsx("img",{src:t.urlProductImage,className:"w-15 rounded"})}),e.jsx("td",{className:"p-2",children:t.quantity}),e.jsxs("td",{className:"p-2",children:[t.price.toLocaleString(),"₫"]}),e.jsxs("td",{className:"p-2",children:[t.totalPrice.toLocaleString(),"₫"]})]},t.id))})]})}),e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsx("button",{onClick:c,className:"px-4 py-2 bg-gray-300 hover:bg-gray-400 rounded",children:"Đóng"})})]})})})}const re=V(function(){const[c,h]=a.useState([]),[t,r]=a.useState(0),[o,b]=a.useState(8),[i,N]=a.useState(1),[d,m]=a.useState(!0),[y,p]=a.useState(!1),[C,v]=a.useState(null),[E,w]=a.useState(!1),[T,k]=a.useState(""),[S,O]=a.useState(null),[M,D]=a.useState(!1),[P,A]=a.useState([]),[f,I]=a.useState("");a.useEffect(()=>{const s=setTimeout(()=>{j()},500);return()=>clearTimeout(s)},[t,o,f]);const j=async()=>{var s,l;try{m(!0);let n;f.trim()?n=await u.get(`/order/search/${f.trim()}`,{params:{page:t,size:o}}):n=await u.get("/order",{params:{page:t,size:o}}),(l=(s=n.data)==null?void 0:s.data)!=null&&l.content&&(h(n.data.data.content),N(n.data.data.totalPages))}catch(n){console.error("Error fetching orders:",n)}finally{m(!1)}},$=s=>{I(s.target.value),r(0)},L=s=>{s.preventDefault(),j()},z=s=>{v(s),p(!0)},R=()=>{p(!1),v(null)},H=async s=>{try{const l=await u.get(`/orderDetail/${s}`);A(l.data),D(!0)}catch(l){console.error("Error fetching order history:",l)}},_=async(s,l,n)=>{try{await u.delete(`/order/delete/${s}`),c.length===1&&t>0?r(t-1):j()}catch(G){console.error("Error deleting order:",G)}w(!1)};return e.jsxs("div",{className:"flex min-h-screen bg-gray-100",children:[e.jsx(K,{}),e.jsxs("main",{className:"flex-1 p-8 ml-64",children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsx("h1",{className:"text-2xl font-bold",children:"Order Management"})}),e.jsx("div",{className:"mb-4",children:e.jsxs("form",{onSubmit:L,className:"flex items-center max-w-md mx-auto bg-white rounded-lg shadow-sm overflow-hidden",children:[e.jsx("input",{type:"text",placeholder:"Search orders...",className:"flex-1 px-4 py-2 focus:outline-none",value:f,onChange:$}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-500 text-white hover:bg-blue-600 transition-colors",children:e.jsx(F,{size:20})})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"ID"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Name"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total Amount"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Phone"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Note"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Address"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Payment Method"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Order Date"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:d?e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"px-5 py-3 text-center",children:e.jsx("div",{className:"animate-pulse flex justify-center",children:e.jsx("div",{className:"h-4 w-1/2 bg-gray-200 rounded"})})})}):c.length>0?c.map(s=>{var l;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-3 py-3 whitespace-nowrap",children:s.id}),e.jsx("td",{className:"px-3 py-3 whitespace-nowrap",children:s.addressDTO?`${s.addressDTO.receiverName}`:e.jsx("span",{className:"italic text-gray-400",children:"Chưa có ten"})}),e.jsxs("td",{className:"px-3 py-3 whitespace-nowrap",children:[(l=s.totalAmount)==null?void 0:l.toLocaleString(),"₫"]}),e.jsx("td",{className:"px-3 py-3 max-w-xs truncate",children:s.addressDTO?`${s.addressDTO.phoneNumber}`:e.jsx("span",{className:"italic text-gray-400",children:"Chưa có sdt"})}),e.jsx("td",{className:"px-3 py-3 max-w-xs truncate",children:s.note}),e.jsx("td",{className:"px-3 py-3 whitespace-nowrap",children:e.jsx("span",{className:`
                                                    px-2 py-1 rounded-full text-xs font-semibold
                                                    ${s.status==="PENDING"?"bg-yellow-100 text-yellow-800":""}
                                                    ${s.status==="CONFIRMED"?"bg-blue-100 text-blue-800":""}
                                                    ${s.status==="IN_PREPARATION"?"bg-purple-100 text-purple-800":""}
                                                    ${s.status==="SERVED"?"bg-green-100 text-green-800":""}
                                                    ${s.status==="COMPLETED"?"bg-emerald-100 text-emerald-800":""}
                                                    ${s.status==="CANCELED"?"bg-red-100 text-red-800":""}
                                                `,children:s.status})}),e.jsx("td",{className:"px-3 py-4 whitespace-nowrap",children:s.addressDTO?`${s.addressDTO.homeAddress} - ${s.addressDTO.commune} - ${s.addressDTO.district} - ${s.addressDTO.city}`:e.jsx("span",{className:"italic text-gray-400",children:"Chưa có địa chỉ"})}),e.jsx("td",{className:"px-3 py-4 whitespace-nowrap",children:s.paymentMethod}),e.jsx("td",{className:"px-3 py-4 whitespace-nowrap",children:new Date(s.orderDate).toLocaleDateString()}),e.jsx("td",{className:"px-3 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>z(s),className:"text-blue-500 hover:text-blue-700",title:"Edit",children:e.jsx(U,{size:20})}),e.jsx("button",{onClick:()=>{k("Are you sure you want to delete this order?"),O(()=>()=>{var n;return _(s.id,((n=s.user)==null?void 0:n.id)??null,s.sessionId)}),w(!0)},className:"text-red-500 hover:text-red-700",title:"Delete",children:e.jsx(q,{size:20})}),e.jsx("button",{onClick:()=>H(s.id),className:"text-purple-500 hover:text-purple-700",title:"History",children:e.jsx(B,{size:20})})]})})]},s.id)}):e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"px-6 py-4 text-center text-gray-500",children:"No orders found"})})})]})}),e.jsxs("div",{className:"px-6 py-4 border-t border-gray-200 flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1 flex justify-between sm:hidden",children:[e.jsx("button",{onClick:()=>r(s=>Math.max(s-1,0)),disabled:t===0,className:"relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50",children:"Previous"}),e.jsx("button",{onClick:()=>r(s=>Math.min(s+1,i-1)),disabled:t>=i-1,className:"ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50",children:"Next"})]}),e.jsxs("div",{className:"hidden sm:flex-1 sm:flex sm:items-center sm:justify-between",children:[e.jsx("div",{children:e.jsxs("p",{className:"text-sm text-gray-700",children:["Showing page ",e.jsx("span",{className:"font-medium",children:t+1})," of"," ",e.jsx("span",{className:"font-medium",children:i})]})}),e.jsx("div",{children:e.jsxs("nav",{className:"relative z-0 inline-flex rounded-md shadow-sm -space-x-px","aria-label":"Pagination",children:[e.jsxs("button",{onClick:()=>r(s=>Math.max(s-1,0)),disabled:t===0,className:"relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50",children:[e.jsx("span",{className:"sr-only",children:"Previous"}),"←"]}),Array.from({length:i},(s,l)=>e.jsx("button",{onClick:()=>r(l),className:`relative inline-flex items-center px-4 py-2 border text-sm font-medium ${t===l?"bg-blue-50 border-blue-500 text-blue-600":"bg-white border-gray-300 text-gray-500 hover:bg-gray-50"}`,children:l+1},l)),e.jsxs("button",{onClick:()=>r(s=>Math.min(s+1,i-1)),disabled:t>=i-1,className:"relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50",children:[e.jsx("span",{className:"sr-only",children:"Next"}),"→"]})]})})]})]})]}),e.jsx(J,{open:E,message:T,onConfirm:async()=>{S&&S()},onCancel:()=>w(!1)}),e.jsx(W,{open:y,onClose:R,onAddOrUpdate:j,initialOrder:C}),e.jsx(X,{open:M,onClose:()=>D(!1),items:P})]})]})});export{re as default};
