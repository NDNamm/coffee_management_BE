import{w as I}from"./with-props-CIDimU0D.js";import{t as L,a as i,o as e}from"./chunk-DQRVZFIR-CDtcAPRC.js";import{g as k,H as x}from"./Header-D-1lqB9W.js";import{a as l}from"./ConfirmDialog-CgZmBqnd.js";import"./iconBase-BIXBbqyS.js";import"./index-VWaDGczM.js";const F=I(function(){var C;const v=L(),c=new URLSearchParams(v.search).get("id"),o=k(),[s,m]=i.useState(null),[S,g]=i.useState(!0),[u,b]=i.useState(null),[f,B]=i.useState(1),[d,p]=i.useState(0),[j,N]=i.useState(""),[h,y]=i.useState(!1);if(i.useEffect(()=>{if(!c){b("Không tìm thấy sản phẩm"),g(!1);return}(async()=>{try{const a=await l.get(`/product/${c}`);m(a.data.data),g(!1)}catch{b("Lỗi khi tải sản phẩm"),g(!1);return}try{const r=(await l.get(`/rating/${c}`)).data.data;m(n=>n&&{...n,rating:r})}catch(a){console.error("Lỗi khi lấy đánh giá:",a)}})()},[c]),S)return e.jsxs("div",{className:"min-h-screen bg-[#f8f5f2]",children:[e.jsx(x,{}),e.jsx("div",{className:"max-w-5xl mx-auto px-8 py-12 text-center",children:e.jsx("p",{className:"text-[#8B5E3C]",children:"Đang tải sản phẩm..."})})]});if(u)return e.jsxs("div",{className:"min-h-screen bg-[#f8f5f2]",children:[e.jsx(x,{}),e.jsx("div",{className:"max-w-5xl mx-auto px-8 py-12 text-center",children:e.jsx("p",{className:"text-red-600",children:u})})]});if(!s)return null;const E=async()=>{if(!s)return;const t={productId:c,quantity:f,price:s.price};try{if(o)console.log("Gửi đi:",t),await l.post("/cart/add",t);else{let a=localStorage.getItem("sessionId");a||(a=(await l.post("/cart/session/create")).data.sessionId,localStorage.setItem("sessionId",a)),await l.post(`cart/session/add?sessionId=${a}`,{...t,sessionId:a})}alert("Đã thêm vào giỏ hàng thành công!")}catch(a){console.error(a),alert("Có lỗi xảy ra khi thêm vào giỏ hàng!")}},A=async()=>{if(!o){alert("Bạn cần đăng nhập để gửi đánh giá.");return}if(d===0){alert("Vui lòng chọn số sao đánh giá.");return}y(!0);try{const t={productId:s.id,ratingValue:d,comment:j.trim()},r=(await l.post("/rating/add",t)).data;m(n=>n&&{...n,rating:n.rating?[r,...n.rating]:[r],averageRating:n.rating&&n.rating.length>0?(n.averageRating*n.rating.length+d)/(n.rating.length+1):d}),p(0),N(""),alert("Cảm ơn bạn đã đánh giá!")}catch(t){console.error(t),alert("Gửi đánh giá thất bại, vui lòng thử lại.")}y(!1)},w=t=>{if(t==null||isNaN(t))return e.jsx("span",{className:"text-gray-500",children:"Chưa có đánh giá"});const a=Math.round(t);return e.jsxs("div",{className:"flex items-center gap-1",children:[[1,2,3,4,5].map(r=>e.jsx("span",{className:`text-xl ${r<=a?"text-[#8B5E3C]":"text-gray-300"}`,children:"★"},r)),e.jsxs("span",{className:"ml-2 text-sm text-gray-600",children:["(",t.toFixed(1),")"]})]})};return e.jsxs("div",{className:"bg-[#f8f5f2] min-h-screen",children:[e.jsx(x,{}),e.jsx("section",{className:"max-w-5xl mx-auto px-8 py-12",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-8",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-10",children:[e.jsxs("div",{className:"md:w-1/2",children:[e.jsx("img",{src:s.imageUrl||"/default.png",alt:s.namePro,className:"w-full h-96 rounded-lg object-cover mb-4 border-2 border-[#8B5E3C]"}),s.imagesDTO&&s.imagesDTO.length>1&&e.jsx("div",{className:"flex gap-3 overflow-x-auto",children:s.imagesDTO.map(t=>e.jsx("img",{src:t.imageUrl,alt:`Ảnh phụ ${t.id}`,className:"w-20 h-20 border-2 border-gray-300 cursor-pointer hover:border-[#8B5E3C] object-cover rounded",onClick:()=>m(a=>a&&{...a,imageUrl:t.imageUrl})},t.id))})]}),e.jsxs("div",{className:"md:w-1/2",children:[e.jsx("h1",{className:"text-3xl font-bold text-[#2f2210] mb-4",children:s.namePro}),e.jsx("div",{className:"mb-6",children:s.averageRating?e.jsxs("div",{className:"flex items-center gap-2",children:[w(s.averageRating),e.jsxs("span",{className:"text-sm text-gray-600",children:["(",((C=s.rating)==null?void 0:C.length)||0," đánh giá)"]})]}):e.jsx("span",{className:"text-gray-500",children:"Chưa có đánh giá"})}),e.jsx("p",{className:"text-gray-700 mb-6",children:s.description}),e.jsx("div",{className:"mb-6",children:e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-semibold ${s.status==="AVAILABLE"?"bg-green-200 text-green-800":s.status==="OUT_OF_STOCK"?"bg-red-200 text-red-800":"bg-gray-200 text-gray-800"}`,children:s.status==="AVAILABLE"?"Còn hàng":s.status==="OUT_OF_STOCK"?"Hết hàng":"Ngừng kinh doanh"})}),e.jsxs("p",{className:"text-2xl font-bold text-[#8B5E3C] mb-6",children:[s.price.toLocaleString("vi-VN"),"đ"]}),e.jsxs("div",{className:"flex items-center gap-4 mb-8",children:[e.jsx("label",{htmlFor:"quantity",className:"font-semibold text-[#2f2210]",children:"Số lượng:"}),e.jsx("input",{id:"quantity",type:"number",min:1,max:100,value:f,onChange:t=>B(Math.max(1,Math.min(100,Number(t.target.value)))),className:"w-20 border-2 border-[#8B5E3C] rounded px-3 py-2 text-center focus:outline-none focus:ring-1 focus:ring-[#8B5E3C]"})]}),e.jsx("button",{disabled:s.status!=="AVAILABLE",onClick:E,className:`w-full py-3 rounded-lg font-semibold transition-colors ${s.status==="AVAILABLE"?"bg-[#8B5E3C] text-white hover:bg-[#704326]":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,children:s.status==="AVAILABLE"?"Thêm vào giỏ hàng":"Sản phẩm không khả dụng"})]})]}),e.jsxs("div",{className:"mt-12 pt-8 border-t border-[#D6C6B8]",children:[e.jsx("h2",{className:"text-2xl font-bold text-[#2f2210] mb-6",children:"Đánh giá sản phẩm"}),s.rating&&s.rating.length>0?e.jsx("div",{className:"space-y-6",children:s.rating.map(t=>e.jsxs("div",{className:"border-b border-[#D6C6B8] pb-6 last:border-0",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("h3",{className:"font-semibold text-[#2f2210]",children:t.userName}),e.jsx("div",{className:"text-sm text-gray-500",children:new Date(t.createdAt).toLocaleDateString()})]}),e.jsx("div",{className:"mb-3",children:w(t.ratingValue)}),e.jsx("p",{className:"text-gray-700",children:t.comment})]},t.id))}):e.jsx("p",{className:"text-gray-500",children:"Chưa có đánh giá nào."}),e.jsxs("div",{className:"mt-12 bg-[#f8f5f2] p-6 rounded-lg",children:[e.jsx("h3",{className:"text-xl font-semibold text-[#2f2210] mb-4",children:"Viết đánh giá của bạn"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block font-medium text-[#2f2210] mb-2",children:"Đánh giá của bạn"}),e.jsx("div",{className:"flex gap-2",children:[1,2,3,4,5].map(t=>e.jsx("button",{type:"button",onClick:()=>p(t),className:`text-2xl ${t<=d?"text-[#8B5E3C]":"text-gray-300"}`,children:"★"},t))})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"comment",className:"block font-medium text-[#2f2210] mb-2",children:"Nhận xét"}),e.jsx("textarea",{id:"comment",rows:4,className:"w-full border-2 border-[#D6C6B8] rounded p-3 focus:outline-none focus:ring-1 focus:ring-[#8B5E3C]",value:j,onChange:t=>N(t.target.value),placeholder:"Chia sẻ cảm nhận của bạn về sản phẩm..."})]}),e.jsx("button",{onClick:A,disabled:h||!o,className:`px-6 py-2 rounded-lg font-medium ${h||!o?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-[#8B5E3C] text-white hover:bg-[#704326]"}`,children:o?h?"Đang gửi...":"Gửi đánh giá":"Đăng nhập để đánh giá"})]})]})]})})]})});export{F as default};
