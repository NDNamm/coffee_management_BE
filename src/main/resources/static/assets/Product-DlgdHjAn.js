import{w as P}from"./with-props-CIDimU0D.js";import{a as r,o as e}from"./chunk-DQRVZFIR-CDtcAPRC.js";import{L as U,M as $,a as R,b as _,c as F}from"./dialog-Yo9MHd0L.js";import{a as y,C as B}from"./ConfirmDialog-CgZmBqnd.js";import{S as V}from"./SideBar-CPVLx_RP.js";import"./iconBase-BIXBbqyS.js";import"./index-BRZMWsSF.js";const H=[{value:"DISCONTINUED",label:"Ngừng bán"},{value:"OUT_OF_STOCK",label:"Hết hàng"},{value:"AVAILABLE",label:"Còn hàng"}];function K({open:A,onClose:x,onAddOrUpdate:O,initialProduct:a}){const[i,p]=r.useState(""),[E,c]=r.useState(""),[w,v]=r.useState(""),[f,S]=r.useState(""),[h,C]=r.useState(""),[u,M]=r.useState([]),[g,k]=r.useState([]),[D,b]=r.useState([]),[T,m]=r.useState(null);r.useEffect(()=>{(async()=>{try{const d=(await y.get("/category",{params:{page:0,size:1}})).data.data.totalElements,j=await y.get("/category",{params:{page:0,size:d}});M(j.data.data.content)}catch(n){console.error("Lỗi khi load danh mục:",n)}})()},[]),r.useEffect(()=>{var s,n;a?(p(a.namePro||""),c(a.description||""),v(((s=a.price)==null?void 0:s.toString())||""),S(a.status||""),C(((n=a.categoryId)==null?void 0:n.toString())||""),k([]),b(Array.isArray(a.imagesDTO)?a.imagesDTO.map(d=>d.imageUrl):[])):(p(""),c(""),v(""),S(""),C(""),k([]),b([]))},[a,A]);const L=async()=>{var j;if(!i.trim()||!w||!h){alert("Vui lòng nhập đầy đủ tên, giá và chọn loại sản phẩm.");return}const s={namePro:i,description:E,price:parseFloat(w)};f&&(s.status=f);const n=new FormData,d=new Blob([JSON.stringify(s)],{type:"application/json"});n.append("productDTO",d),g.forEach(N=>n.append("image",N));try{if(a!=null&&a.id)await y.put(`/product/update/${a.id}`,n,{headers:{"Content-Type":"multipart/form-data"}}),m("Cập nhật sản phẩm thành công!");else{if(g.length===0){alert("Vui lòng chọn ít nhất một ảnh.");return}await y.post(`/product/add/${h}`,n,{headers:{"Content-Type":"multipart/form-data"}}),m("Thêm sản phẩm thành công!")}setTimeout(()=>{O(),x(),m(null)},1e3)}catch(N){console.error("Lỗi khi thêm/sửa sản phẩm:",N),alert(((j=N.response)==null?void 0:j.data)||"Lỗi không xác định")}};return e.jsxs(U,{open:A,onClose:x,className:"fixed z-50 inset-0 flex items-center justify-center",children:[e.jsx("div",{className:"fixed inset-0 bg-black opacity-30","aria-hidden":"true"}),e.jsxs("div",{className:"bg-white rounded-xl p-6 z-50 shadow-xl w-[400px] overflow-y-auto max-h-[90vh]",children:[T&&e.jsx("div",{className:"bg-green-100 text-green-700 text-sm p-2 rounded mb-4 text-center",children:T}),e.jsx(U.Title,{className:"text-lg font-semibold mb-4",children:a?"Sửa Sản Phẩm":"Thêm Sản Phẩm"}),!a&&e.jsxs("select",{className:"w-full border px-3 py-2 mb-3 rounded",value:h,onChange:s=>C(s.target.value),children:[e.jsx("option",{value:"",children:"-- Chọn loại sản phẩm --"}),u==null?void 0:u.map(s=>e.jsx("option",{value:s.id,children:s.nameCate},s.id))]}),e.jsx("input",{className:"w-full border px-3 py-2 mb-3 rounded",placeholder:"Tên sản phẩm",value:i,onChange:s=>p(s.target.value)}),e.jsx("input",{className:"w-full border px-3 py-2 mb-3 rounded",placeholder:"Giá",type:"number",value:w,onChange:s=>v(s.target.value)}),a&&e.jsxs("select",{className:"w-full border px-3 py-2 mb-3 rounded",value:f,onChange:s=>S(s.target.value),children:[e.jsx("option",{value:"",children:"-- Chọn trạng thái --"}),H.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))]}),e.jsx("textarea",{className:"w-full border px-3 py-2 mb-3 rounded",placeholder:"Mô tả",rows:3,value:E,onChange:s=>c(s.target.value)}),e.jsx("input",{id:"image-upload",type:"file",accept:"image/*",multiple:!0,onChange:s=>{const n=Array.from(s.target.files||[]);k(n),b(n.map(d=>URL.createObjectURL(d)))},className:"hidden"}),Array.isArray(D)&&D.length>0&&e.jsx("div",{className:"grid grid-cols-2 gap-2 mb-3",children:D.map((s,n)=>e.jsx("img",{src:s,alt:`Preview ${n}`,className:"h-24 w-full object-cover rounded border"},n))}),e.jsx("label",{htmlFor:"image-upload",className:"block bg-indigo-500 hover:bg-indigo-600 text-white text-center cursor-pointer px-4 py-2 rounded mb-4",children:g.length>0?"Chọn ảnh khác":"Chọn ảnh"}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx("button",{onClick:x,className:"bg-gray-300 px-4 py-2 rounded hover:bg-gray-400",children:"Hủy"}),e.jsx("button",{onClick:L,className:"bg-blue-500 px-4 py-2 text-white rounded hover:bg-blue-600",children:a?"Cập nhật":"Thêm"})]})]})]})}const Z=P(function(){const[x,O]=r.useState([]),[a,i]=r.useState(0),[p,E]=r.useState(6),[c,w]=r.useState(1),[v,f]=r.useState(!0),[S,h]=r.useState(!1),[C,u]=r.useState(null),[M,g]=r.useState(!1),[k,D]=r.useState(""),[b,T]=r.useState(null),[m,L]=r.useState("");r.useEffect(()=>{const t=setTimeout(()=>{s()},500);return()=>clearTimeout(t)},[a,p,m]);const s=async()=>{var t,l;try{f(!0);let o;m.trim()?o=await y.get(`/product/search/${m.trim()}`,{params:{page:a,size:p}}):o=await y.get("/product",{params:{page:a,size:p}}),(l=(t=o.data)==null?void 0:t.data)!=null&&l.content&&(O(o.data.data.content),w(o.data.data.totalPages))}catch(o){console.error("Error fetching products:",o)}finally{f(!1)}},n=t=>{L(t.target.value),i(0)},d=t=>{t.preventDefault(),s()},j=()=>{u(null),h(!0)},N=t=>{u(t),h(!0)},I=()=>{h(!1),u(null)},z=async t=>{try{await y.delete(`/product/delete/${t}`),x.length===1&&a>0?i(a-1):s(),g(!1)}catch(l){console.error("Error deleting product:",l)}};return e.jsxs("div",{className:"flex min-h-screen bg-gray-100",children:[e.jsx(V,{}),e.jsxs("main",{className:"flex-1 p-8 ml-64",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Product Management"}),e.jsxs("button",{type:"button",onClick:j,className:"flex items-center gap-2 px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors",children:[e.jsx($,{size:20}),"Add Product"]})]}),e.jsx("div",{className:"mb-4",children:e.jsxs("form",{onSubmit:d,className:"flex items-center max-w-md mx-auto bg-white rounded-lg shadow-sm overflow-hidden",children:[e.jsx("input",{type:"text",placeholder:"Search products...",className:"flex-1 px-4 py-2 focus:outline-none",value:m,onChange:n}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-500 text-white hover:bg-blue-600 transition-colors",children:e.jsx(R,{size:20})})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-5 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"ID"}),e.jsx("th",{className:"px-5 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Name"}),e.jsx("th",{className:"px-5 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Image"}),e.jsx("th",{className:"px-5 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Price"}),e.jsx("th",{className:"px-5 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Description"}),e.jsx("th",{className:"px-5 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-5 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Created"}),e.jsx("th",{className:"px-5 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Updated"}),e.jsx("th",{className:"px-5 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:v?e.jsx("tr",{children:e.jsx("td",{colSpan:9,className:"px-5 py-2 text-center",children:e.jsx("div",{className:"animate-pulse flex justify-center",children:e.jsx("div",{className:"h-4 w-1/2 bg-gray-200 rounded"})})})}):x.length>0?x.map(t=>{var l,o;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-5 py-3 whitespace-nowrap",children:t.id}),e.jsx("td",{className:"px-5 py-3 whitespace-nowrap",children:t.namePro}),e.jsx("td",{className:"px-5 py-3 whitespace-nowrap",children:((l=t.imageUrl)==null?void 0:l[0])&&e.jsx("img",{src:t.imageUrl,alt:t.namePro,className:"h-12 w-16 object-cover rounded mx-auto"})}),e.jsxs("td",{className:"px-5 py-3 whitespace",children:[(o=t.price)==null?void 0:o.toLocaleString(),"₫"]}),e.jsx("td",{className:"px-5 py-3 max-w-xs",children:t.description}),e.jsx("td",{className:"px-5 py-3 whitespace-nowrap",children:e.jsx("span",{className:`
                                                        px-2 py-1 rounded-full text-xs font-semibold
                                                        ${t.status==="AVAILABLE"?"bg-green-200 text-green-800":""}
                                                        ${t.status==="OUT_OF_STOCK"?"bg-red-200 text-red-800":""}
                                                        ${t.status==="DISCONTINUED"?"bg-gray-300 text-gray-800":""}
                                                    `,children:t.status})}),e.jsx("td",{className:"px-5py-3 whitespace-nowrap",children:new Date(t.createdAt).toLocaleDateString()}),e.jsx("td",{className:"px-5 py-3 whitespace-nowrap",children:new Date(t.updatedAt).toLocaleDateString()}),e.jsx("td",{className:"px-5 py-3 whitespace-nowrap",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{type:"button",onClick:()=>N(t),className:"text-blue-500 hover:text-blue-700",title:"Edit",children:e.jsx(_,{size:20})}),e.jsx("button",{onClick:()=>{D("Are you sure you want to delete this product?"),T(()=>()=>z(t.id)),g(!0)},type:"button",className:"text-red-500 hover:text-red-700",title:"Delete",children:e.jsx(F,{size:20})})]})})]},t.id)}):e.jsx("tr",{children:e.jsx("td",{colSpan:9,className:"px-6 py-4 text-center text-gray-500",children:"No products found"})})})]})}),e.jsxs("div",{className:"px-6 py-4 border-t border-gray-200 flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1 flex justify-between sm:hidden",children:[e.jsx("button",{onClick:()=>i(t=>Math.max(t-1,0)),disabled:a===0,className:"relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50",children:"Previous"}),e.jsx("button",{onClick:()=>i(t=>Math.min(t+1,c-1)),disabled:a>=c-1,className:"ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50",children:"Next"})]}),e.jsxs("div",{className:"hidden sm:flex-1 sm:flex sm:items-center sm:justify-between",children:[e.jsx("div",{children:e.jsxs("p",{className:"text-sm text-gray-700",children:["Showing page ",e.jsx("span",{className:"font-medium",children:a+1})," of"," ",e.jsx("span",{className:"font-medium",children:c})]})}),e.jsx("div",{children:e.jsxs("nav",{className:"relative z-0 inline-flex rounded-md shadow-sm -space-x-px","aria-label":"Pagination",children:[e.jsxs("button",{onClick:()=>i(t=>Math.max(t-1,0)),disabled:a===0,className:"relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50",children:[e.jsx("span",{className:"sr-only",children:"Previous"}),"←"]}),Array.from({length:c},(t,l)=>e.jsx("button",{onClick:()=>i(l),className:`relative inline-flex items-center px-4 py-2 border text-sm font-medium ${a===l?"bg-blue-50 border-blue-500 text-blue-600":"bg-white border-gray-300 text-gray-500 hover:bg-gray-50"}`,children:l+1},l)),e.jsxs("button",{onClick:()=>i(t=>Math.min(t+1,c-1)),disabled:a>=c-1,className:"relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50",children:[e.jsx("span",{className:"sr-only",children:"Next"}),"→"]})]})})]})]})]}),e.jsx(B,{open:M,message:k,onConfirm:async()=>{b&&b()},onCancel:()=>g(!1)}),e.jsx(K,{open:S,onClose:I,onAddOrUpdate:s,initialProduct:C})]})]})});export{Z as default};
