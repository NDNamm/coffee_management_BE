import{w as T}from"./with-props-CIDimU0D.js";import{a as n,s as A,o as s}from"./chunk-DQRVZFIR-CDtcAPRC.js";import{a as l,C as M}from"./ConfirmDialog-CgZmBqnd.js";import{g as H,H as R}from"./Header-D-1lqB9W.js";import"./iconBase-BIXBbqyS.js";import"./index-VWaDGczM.js";const _=T(function(){const[c,d]=n.useState([]),[v,h]=n.useState(!1),[x,g]=n.useState(null),[p,u]=n.useState([]),[I,f]=n.useState(!1),[b,C]=n.useState(null),r=H(),S=A(),[E,i]=n.useState(!1),[L,j]=n.useState(""),[y,N]=n.useState(null);n.useEffect(()=>{o()},[r]);const o=async()=>{h(!0);try{if(r){const e=await l.get("/cart");d(e.data.data.cartItems||[])}else{const e=localStorage.getItem("sessionId");if(e){const t=await l.get("/cart/session",{params:{sessionId:e}});d(t.data.data.cartItems||[]),console.log("sessionId: "+e)}else d([])}}catch(e){console.error("Lỗi khi reload giỏ hàng:",e),d([])}finally{h(!1)}},D=async e=>{g(e.id);try{const t={productId:e.product.id,quantity:1,price:e.product.price};if(r)await l.post("/cart/add",t);else{const a=localStorage.getItem("sessionId");await l.post(`/cart/session/add?sessionId=${a}`,{...t})}await o()}catch(t){console.error("Lỗi tăng số lượng:",t)}finally{g(null)}},B=async e=>{if(!(e.quantity<=1)){g(e.id);try{const t=e.quantity-1,a={productId:e.product.id,quantity:t,price:e.product.price};if(console.log("updatedCartItemDT: "+a),r)await l.put("/cart/update",a);else{const m=localStorage.getItem("sessionId");await l.put(`/cart/session/update?sessionId=${m}`,{...a})}await o()}catch(t){console.error("Lỗi giảm số lượng:",t)}finally{g(null)}}},O=e=>{j("Bạn có chắc chắn muốn xóa sản phẩm này khỏi giỏ hàng không?"),N(()=>async()=>{try{if(r)await l.delete(`/cart/delete/${e}`);else{const t=localStorage.getItem("sessionId");await l.delete(`/cart/session/delete/${e}`,{params:{sessionId:t}})}await o()}catch(t){console.error("Lỗi xoá sản phẩm:",t)}finally{i(!1)}}),i(!0)},k=()=>{j("Bạn có chắc chắn muốn xóa toàn bộ sản phẩm trong giỏ hàng không?"),N(()=>async()=>{try{if(r)await l.delete("/cart/delete");else{const e=localStorage.getItem("sessionId");await l.delete(`/cart/session/delete?sessionId=${e}`,{params:{sessionId:e}})}await o()}catch(e){console.error("Lỗi xoá toàn bộ giỏ hàng:",e)}finally{i(!1)}}),i(!0)},P=c.reduce((e,t)=>e+t.price*t.quantity,0),$=()=>{if(c.length===0){alert("Giỏ hàng rỗng");return}S("/order",{state:{cartItems:c}})},q=async()=>{var e;f(!0);try{const t=localStorage.getItem("sessionId"),a={};t&&(a.sessionId=t);const m=await l.get("order/history",{params:a});u(((e=m.data.data)==null?void 0:e.content)||[])}catch(t){console.error("Lỗi khi lấy lịch sử đơn hàng:",t),u([])}finally{f(!1)}},w=e=>{C(t=>t===e?null:e)};return n.useEffect(()=>{q()},[r]),s.jsxs("div",{className:"bg-white min-h-screen",children:[s.jsx(R,{}),s.jsx("section",{className:"py-16 px-8 bg-[#f8f5f2]",children:s.jsxs("div",{className:"container mx-auto",children:[s.jsxs("div",{className:"text-center mb-12",children:[s.jsx("h2",{className:"text-3xl text-[#8B5E3C] font-bold uppercase",children:"Giỏ hàng của bạn"}),s.jsx("div",{className:"w-20 h-1 bg-[#8B5E3C] mx-auto mt-4"}),s.jsx("p",{className:"italic text-gray-500 mt-2",children:"Kiểm tra các sản phẩm bạn đã chọn"})]}),v?s.jsx("p",{className:"text-center",children:"Đang tải giỏ hàng..."}):c.length===0?s.jsx("p",{className:"text-center text-gray-500 italic",children:"Chưa có sản phẩm nào trong giỏ hàng."}):s.jsxs("div",{className:"max-w-3xl mx-auto",children:[s.jsx("div",{className:"flex justify-end mb-6",children:s.jsx("button",{onClick:k,className:"px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 transition-colors",children:"Xóa tất cả giỏ hàng"})}),s.jsx("div",{className:"grid md:grid-cols-1 gap-5 ",children:c==null?void 0:c.map(e=>{var t,a;return s.jsx("div",{className:"bg-white p-5 rounded-lg shadow-md hover:shadow-lg transition-shadow border-l-4 border-[#8B5E3C]",children:s.jsxs("div",{className:"flex flex-col md:flex-row items-start md:items-center justify-between gap-4",children:[s.jsxs("div",{className:"flex items-center gap-4 w-full",children:[s.jsx("img",{src:((t=e.product)==null?void 0:t.imageUrl)||"/default.png",alt:((a=e.product)==null?void 0:a.namePro)||"Sản phẩm",className:"w-20 h-20 object-cover rounded border border-gray-200"}),s.jsxs("div",{className:"flex-grow",children:[s.jsx("h3",{className:"font-bold text-gray-800 text-lg",children:s.jsx("span",{className:"font-bold text-gray-800 text-lg mb-1",children:e.product.namePro})}),s.jsxs("div",{className:"flex items-center gap-2 mt-3",children:[s.jsx("button",{disabled:x===e.id,onClick:()=>B(e),className:"px-3 py-1 bg-gray-200 rounded hover:bg-gray-300 disabled:opacity-50",children:"-"}),s.jsx("span",{className:"font-medium",children:e.quantity}),s.jsx("button",{disabled:x===e.id,onClick:()=>D(e),className:"px-3 py-1 bg-gray-200 rounded hover:bg-gray-300 disabled:opacity-50",children:"+"})]})]})]}),s.jsxs("div",{className:"flex justify-end items-center gap-4 w-full",children:[s.jsxs("div",{className:"flex flex-col text-right",children:[s.jsxs("span",{className:"font-bold text-[#8B5E3C] text-lg",children:[e.price.toLocaleString(),"đ"]}),s.jsxs("p",{className:"text-gray-600 mt-1",children:["Tổng: ",(e.quantity*e.price).toLocaleString(),"đ"]})]}),s.jsx("button",{disabled:x===e.id,onClick:()=>O(e.id),className:"px-3 py-1 bg-red-100 text-red-600 rounded hover:bg-red-200 disabled:opacity-50",children:"Xoá"})]})]})},e.id)})}),s.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center border-t pt-6 mt-8 gap-4",children:[s.jsxs("p",{className:"text-xl font-semibold",children:["Tổng tiền: ",s.jsxs("span",{className:"text-[#8B5E3C]",children:[P.toLocaleString(),"đ"]})]}),s.jsx("button",{onClick:$,className:"px-6 py-3 bg-[#8B5E3C] text-white rounded hover:bg-[#6d4b2f] transition-colors font-medium",children:"Đặt hàng"})]})]})]})}),s.jsx("section",{className:"px-8 pb-20",children:s.jsxs("div",{className:"container mx-auto max-w-3xl",children:[s.jsx("h2",{className:"text-2xl font-semibold text-[#8B5E3C] mb-4",children:"Lịch sử đơn hàng"}),I?s.jsx("p",{className:"text-gray-500 italic",children:"Đang tải lịch sử đơn hàng..."}):p.length===0?s.jsx("p",{className:"text-gray-500 italic",children:"Bạn chưa có đơn hàng nào."}):s.jsx("div",{className:"space-y-6",children:p.map(e=>s.jsxs("div",{className:"space-y-2",children:[s.jsx("div",{className:"bg-white rounded-lg shadow p-5 border-l-4 border-[#8B5E3C] hover:shadow-lg transition-all cursor-pointer",onClick:()=>w(e.id),children:s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsxs("div",{children:[s.jsxs("p",{className:"text-lg font-semibold",children:["Mã đơn hàng: #",e.id]}),s.jsxs("p",{className:"text-sm text-gray-600",children:["Ngày đặt: ",new Date(e.orderDate).toLocaleString()]}),s.jsxs("p",{className:"text-sm text-gray-600",children:["Trạng thái: ",s.jsx("span",{className:`
                                                    px-2 py-1 rounded-full text-xs font-semibold
                                                    ${e.status==="PENDING"?"bg-yellow-100 text-yellow-800":""}
                                                    ${e.status==="CONFIRMED"?"bg-blue-100 text-blue-800":""}
                                                    ${e.status==="IN_PREPARATION"?"bg-purple-100 text-purple-800":""}
                                                    ${e.status==="SERVED"?"bg-green-100 text-green-800":""}
                                                    ${e.status==="COMPLETED"?"bg-emerald-100 text-emerald-800":""}
                                                    ${e.status==="CANCELED"?"bg-red-100 text-red-800":""}
                                                `,children:e.status})]})]}),s.jsxs("div",{className:"text-right",children:[s.jsxs("p",{className:"text-[#8B5E3C] text-lg font-bold",children:[e.totalAmount.toLocaleString(),"đ"]}),s.jsxs("p",{className:"text-sm italic text-gray-500",children:["Phương thức: ",e.paymentMethod]}),s.jsx("button",{onClick:t=>{t.stopPropagation(),w(e.id)},className:"text-blue-600 hover:underline text-sm mt-1",children:b===e.id?"Ẩn chi tiết":"Xem chi tiết"})]})]})}),b===e.id&&s.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg shadow-inner",children:[s.jsx("h3",{className:"font-semibold text-lg mb-3",children:"Chi tiết đơn hàng"}),s.jsx("div",{className:"space-y-3",children:e.orderDetailDTO.map(t=>s.jsxs("div",{className:"flex items-center justify-between p-2 border-b",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("img",{src:t.urlProductImage||"/default.png",alt:t.productName,className:"w-12 h-12 rounded-full object-cover border border-gray-200"}),s.jsxs("div",{children:[s.jsx("p",{className:"font-medium",children:t.productName}),s.jsxs("p",{className:"text-sm text-gray-500",children:[t.price.toLocaleString(),"đ x ",t.quantity]})]})]}),s.jsxs("p",{className:"font-semibold",children:[(t.price*t.quantity).toLocaleString(),"đ"]})]},t.id))}),s.jsxs("div",{className:"flex justify-between items-center mt-4 pt-3 border-t",children:[s.jsx("p",{className:"font-semibold",children:"Tổng cộng:"}),s.jsxs("p",{className:"text-lg font-bold text-[#8B5E3C]",children:[e.totalAmount.toLocaleString(),"đ"]})]})]})]},e.id))})]})}),s.jsx(M,{open:E,message:L,onConfirm:()=>{y&&y()},onCancel:()=>i(!1)})]})});export{_ as default};
